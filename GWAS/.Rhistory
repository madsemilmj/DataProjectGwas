theme_bw() +
xlim(rev(levels(table$Reference)))
truth
pred <- factor(
c(
rep(lvs, times = c(54, 32)),
rep(lvs, times = c(27, 231))),
levels = rev(lvs))
pred
getwd()
setwd("C:/Users/Bruger/OneDrive - Aarhus Universitet/dataprojekt_shiny_app")
total_indiv <- 100000
SNP <- 100000
h <- 0.5
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
View(assoc_file)
BFC = 1
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
total_indiv <- 100000
SNP <- 100000
h <- 0.5
BFC = 1
thr = -log10(.05/BFC)
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
nrow(assoc_file)
truth_count_causal <- sum(assoc_file$C)
truth_count_Ncausal <- nrow(assoc_file)-sum(assoc_file$C)
pred_count_causal <- sum(assoc-file$predC)
pred_count_Ncausal <- nrow(assoc_file)-sum(assoc-file$predC)
truth_count_causal <- sum(assoc_file$C)
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(assoc_file$C)
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(86, 258)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(pred_count_causal, pred_count_Ncausal)),
levels = rev(lvs)))
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(pred_count_causal, pred_count_Ncausal)),
levels = rev(lvs)))
caret::confusionMatrix(pred, truth)
lvs <- c("normal", "abnormal")
truth <- factor(rep(lvs, times = c(86, 258)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(54, 32)),
rep(lvs, times = c(27, 231))),
levels = rev(lvs))
xtab <- table(pred, truth)
xtab
lvs <- c("normal", "abnormal")
truth <- factor(rep(lvs, times = c(86, 258)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(54, 32)),
rep(lvs, times = c(27, 231))),
levels = rev(lvs))
xtab <- table(pred, truth)
caret::confusionMatrix(pred, truth)
table <- data.frame(confusionMatrix(pred, truth)$table)
plotTable <- table %>%
mutate(goodbad = ifelse(table$Prediction == table$Reference, "good", "bad")) %>%
group_by(Reference) %>%
mutate(prop = Freq/sum(Freq))
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = Reference, y = Prediction, fill = goodbad, alpha = prop)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(good = "green", bad = "red")) +
theme_bw() +
xlim(rev(levels(table$Reference)))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
xtab <- table(pred, truth)
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
xtab <- table(pred, truth)
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
caret::confusionMatrix(pred, truth)
table <- data.frame(confusionMatrix(pred, truth)$table)
plotTable <- table %>%
mutate(goodbad = ifelse(table$Prediction == table$Reference, "good", "bad")) %>%
group_by(Reference) %>%
mutate(prop = Freq/sum(Freq))
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = Reference, y = Prediction, fill = goodbad, alpha = prop)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(good = "green", bad = "red")) +
theme_bw() +
xlim(rev(levels(table$Reference)))
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(goodbad = ifelse(table$Prediction == table$Reference, "good", "bad")) %>%
group_by(Reference) %>%
mutate(prop = Freq/sum(Freq))
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = Reference, y = Prediction, fill = goodbad, alpha = prop)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(good = "green", bad = "red")) +
theme_bw() +
xlim(rev(levels(table$Reference)))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(goodbad = ifelse(table$Test == table$True, "good", "bad")) %>%
group_by(True) %>%
mutate(prop = Freq/sum(Freq))
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = Reference, y = Prediction, fill = goodbad, alpha = prop)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(good = "green", bad = "red")) +
theme_bw() +
xlim(rev(levels(table$Reference)))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(goodbad = ifelse(table$Test == table$True, "good", "bad")) %>%
group_by(True) %>%
mutate(prop = Freq/sum(Freq))
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = Reference, y = Prediction, fill = goodbad, alpha = prop)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(good = "green", bad = "red")) +
theme_bw() +
xlim(rev(levels(table$True)))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(goodbad = ifelse(table$Test == table$True, "good", "bad")) %>%
group_by(True) %>%
mutate(prop = Freq/sum(Freq))
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = goodbad, alpha = prop)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(good = "green", bad = "red")) +
theme_bw() +
xlim(rev(levels(table$True)))
plotTable
plotTable <- table %>%
mutate(goodbad = ifelse(table$Test == table$True, "good", "bad")) %>%
group_by(True)
plotTable
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(correct = "green", Not_correct = "red")) +
theme_bw() +
xlim(rev(levels(table$True)))
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(Label = ifelse(table$Test == table$True, "Correct", "Not_correct")) %>%
group_by(True)
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(correct = "green", Not_correct = "red")) +
theme_bw() +
xlim(rev(levels(table$True)))
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(Label = ifelse(table$Test == table$True, "Correct", "Not_correct")) %>%
group_by(True)
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(Correct = "green", Not_correct = "red")) +
theme_bw() +
xlim(rev(levels(table$True)))
total_indiv <- 100000
SNP <- 100000
h <- 0.5
BFC = 1
thr = -log10(.05/BFC)
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(Label = ifelse(table$Test == table$True, "Correct", "Not_correct")) %>%
group_by(True)
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(Correct = "green", Not_correct = "red")) +
theme_light() +
xlim(rev(levels(table$True)))
total_indiv <- 100000
SNP <- 100000
h <- 0.5
BFC = 1000000
thr = -log10(.05/BFC)
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(Label = ifelse(table$Test == table$True, "Correct", "Not_correct")) %>%
group_by(True)
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1) +
scale_fill_manual(values = c(Correct = "green", Not_correct = "red")) +
theme_light() +
xlim(rev(levels(table$True)))
setwd("C:\\Users\\Bruger\\Desktop\\DataProjectGWAS")
library("devtools")
setwd("./GWAS")
document()
total_indiv <- 100000
SNP <- 100000
h <- 0.5
BFC = 1000000
thr = -log10(.05/BFC)
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(Label = ifelse(table$Test == table$True, "Correct", "Not_correct")) %>%
group_by(True)
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1, size=20) +
scale_fill_manual(values = c(Correct = "green", Not_correct = "red")) +
theme_light() +
xlim(rev(levels(table$True)))
data/code from "2 class example" example courtesy of ?caret::confusionMatrix
total_indiv <- 100000
SNP <- 100000
h <- 0.5
BFC = 1000000
thr = -log10(.05/BFC)
assoc_string <- paste("./data/case_ctrl","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.qassoc", sep="")
assoc_file <- data.table::fread(assoc_string)
causal_string <- paste("./data/BETA","_",format(total_indiv,scientific = F),"_",format(SNP,scientific = F),"_",h*100,"_5.txt", sep="")
causal1 <- data.table::fread(causal_string)
causal1$C <- ifelse(causal1$V2 != 0, "yes", "no")
assoc_file <- dplyr::left_join(assoc_file,dplyr::select(causal1,V1,C), by = c("SNP" = "V1"))
assoc_file$predC <- ifelse(-log10(assoc_file$P)>thr,1,0)
truth_count_causal <- sum(ifelse(assoc_file$C == "yes",1,0))
truth_count_Ncausal <- nrow(assoc_file)-truth_count_causal
pred_count_causal <- sum(assoc_file$predC)
pred_count_Ncausal <- nrow(assoc_file)-pred_count_causal
#first col
caus_caus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 1,1,0))
caus_notcaus <- sum(ifelse(assoc_file$C == "yes" & assoc_file$predC == 0,1,0))
#second_col
notcaus_caus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 1,1,0))
notcaus_notcaus <- sum(ifelse(assoc_file$C == "no" & assoc_file$predC == 0,1,0))
lvs <- c("Causal", "Not Causal")
truth <- factor(rep(lvs, times = c(truth_count_causal, truth_count_Ncausal)),
levels = rev(lvs))
pred <- factor(
c(
rep(lvs, times = c(caus_caus, caus_notcaus)),
rep(lvs, times = c(notcaus_caus, notcaus_notcaus))),
levels = rev(lvs))
table <- data.frame(caret::confusionMatrix(pred, truth,dnn = c("Test", "True"))$table)
plotTable <- table %>%
mutate(Label = ifelse(table$Test == table$True, "Correct", "Not_correct")) %>%
group_by(True)
# fill alpha relative to sensitivity/specificity by proportional outcomes within reference groups (see dplyr code above as well as original confusion matrix for comparison)
ggplot(data = plotTable, mapping = aes(x = True, y = Test, fill = Label)) +
geom_tile() +
geom_text(aes(label = Freq), vjust = .5, fontface  = "bold", alpha = 1, size=14) +
scale_fill_manual(values = c(Correct = "green", Not_correct = "red")) +
theme_light() +
xlim(rev(levels(table$True)))
setwd("C:\\Users\\Bruger\\Desktop\\DataProjectGWAS")
library("devtools")
setwd("./GWAS")
document()
